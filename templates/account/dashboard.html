{% extends "base.html" %}
{% load static %}

<!-- Dashboard area - users taken here after log in-->
{% block content %}
<div class="container my-5">
    <h1>Welcome to your dashboard {{request.user.first_name}}</h1>
    <hr>
    <div>
        <ul>
            <a href="{{ user.get_absolute_url }}" class="btn btn-outline-dark">View Your Profile
            </a>
            <a href="{% url 'edit' %}" class="btn btn-outline-dark">SETUP/Edit Your Profile</a>
            <a href="{% url 'password_change' %}" class="btn btn-outline-dark">Change Your
                Password</a>
        </ul>
    </div>
    <br>
    <h2 class="display-6"> You have shared {{locations.count | default_if_none:"0"}} spot(s). </h2>

    <!-- Shows the total number of locations added by user. Uses infinite scroll-->
    
    <div class="row infinite-container">
         {% for location in page_obj %}
        <div class="infinite-item">
            <p><img src="{{location.image.url}}" alt="{{ location.image_alt }}" class="img-fluid"></p>
            {{location.title}} | Posted on {{location.posted_date}}
        
            <p>{{location.description | truncatechars:280}}</p>
            <div class="container py-3">
                    <a href="{% url 'location_detail' slug=location.slug %}" class="btn btn-outline-dark">View</a>
                    <a href="{% url 'edit_location' slug=location.slug %}" class="btn btn-outline-dark">Edit</a>
                    <a href="{% url 'delete_location' slug=location.slug %}" class="btn btn-outline-dark">Delete</a>
            </div>
        </div>
    </div>
        {% endfor %}


<!-- Script for infinite scroll-->
<div class="d-flex d-none position-fixed" style="top:35vh;left:46vw">
    <button class="btn btn-primary loading">
        <span class="spinner-border spinner-border-sm"></span>
        Please wait...
    </button>
</div>
    <div class="container my-5">
            {% if page_obj.has_next %}
            <a class="btn btn-outline-success" href="?page={{ page_obj.next_page_number }}">
                CLICK to see more</a>
            {% endif %}
    </div>

<script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'js/infinite.min.js' %}"></script>

<script>
    var infinite = new Waypoint.Infinite({
        element: $('.infinite-container')[0],

        offset: 'bottom-in-view',

        onBeforePageLoad: function () {
            $('.loading').show();
        },
        onAfterPageLoad: function () {
            $('.loading').hide();
        }

    })
</script>

{% endblock %}